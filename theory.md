# Token Entropy Estimator 解説編

本ドキュメントでは、`Token Entropy Estimator` が内部で用いている**エントロピー計算**や**強度推定の理論背景**をまとめます。

数学的・情報理論的な部分に踏み込み、図解も交えて直感的に理解できるようにしています。

---

## 1. エントロピーとは何か？

### 1.1 情報エントロピーの定義
情報理論における**エントロピー**とは、ある確率分布の「不確実さ」を表す指標です。  

```
H(X) = -∑(i=1 to n) p_i × log₂(p_i)
```

- X：確率変数（文字や記号の集合）  
- p_i：各文字が出現する確率  
- 単位：ビット（bit）

---

### 1.2 直感的なイメージ

```
文字集合 Σ
├── 'a' (25%) → p=0.25
├── 'b' (25%) → p=0.25
├── 'c' (25%) → p=0.25
└── 'd' (25%) → p=0.25
↓
H = 2.0 bits（完全ランダム）
```


👉 出現確率が均等だとエントロピーは最大に。偏ると小さくなる。

---

## 2. 推定式（本ツールで採用）

### 2.1 一様分布仮定
入力が「アルファベットサイズ |Σ| から n 回独立に選ばれた」と仮定した場合：

```
H_est = n × log₂(|Σ|)
```

例：  
- 英数字62種 × 16桁  
  **H ≈ 16 × log₂(62) ≈ 95.3 bits**

```
英数字62文字
[0-9][a-z][A-Z]
↓
長さ16桁
↓
H ≈ 95 bits
```

---

### 2.2 Shannon エントロピー（参考）
入力内の文字頻度から算出：

```
H_emp = (-∑ p_i × log₂(p_i)) × n
```

- ランダム文字列 → H_est と近似  
- 偏った文字列（例: aaaaaaaa…） → H_emp ≪ H_est

---

## 3. 総当たり攻撃モデル

### 3.1 探索空間
```
|Σ|ⁿ = 2^H_est
```

例: 英数62種 × 8桁

探索空間 = 62^8 ≈ 2.18e14

### 3.2 平均必要試行数

攻撃者が総当たりするとき、「探索空間の半分 ≈ 中央値」で発見


```
N_guess ≈ |Σ|ⁿ ÷ 2
```

### 3.3 総当たり所要時間
```
T ≈ (|Σ|ⁿ ÷ 2) ÷ R
```

- R = 攻撃レート（例：10⁹ guesses/sec）

```
H = 95 bits
探索空間 = 2^95 ≈ 4e28
中央値試行 = 2^94
R = 1e9/sec
→ 推定時間 ≈ 6.3e14 年
```

---

## 4. UUID v4 の特例

```
UUID v4 = 128bit だが…
├─ version フィールド = 4 固定 (4bit)
└─ variant フィールド = 特定パターン (2-3bit)
↓
実効エントロピー ≈ 122 bits
```

本ツールでは教育上「≈122 bits」と近似表示。

---

## 5. 強度判定の目安

| 推定エントロピー | 判定   | 例 |
|-----------------|-------|--------------------|
| <64 bits        | 弱い  | 英数字8桁程度 |
| 64〜99 bits     | ふつう | 英数字16桁程度 |
| ≥100 bits       | 強い  | 英数字32桁, UUID v4 |

---

## 6. 注意事項

- 計算は「理想的な一様乱数」を仮定  
- 人為的パターン（時刻や連番）は評価対象外  
- 単一サンプルから真のエントロピーを厳密に推定することは不可能  

👉 あくまで **教育・設計支援**用の推定ツール

---

## 7. 参考文献
- C. E. Shannon, *A Mathematical Theory of Communication*, 1948  
- RFC 4122: A Universally Unique IDentifier (UUID) URN Namespace  
- NIST SP 800-63B: Digital Identity Guidelines – Authentication and Lifecycle Management
